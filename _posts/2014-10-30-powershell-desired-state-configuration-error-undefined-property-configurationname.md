---
ID: 10759
post_title: 'PowerShell Desired State Configuration Error: Undefined Property ConfigurationName'
author: Mike F Robbins
post_excerpt: ""
layout: post
permalink: >
  https://mikefrobbins.com/2014/10/30/powershell-desired-state-configuration-error-undefined-property-configurationname/
published: true
post_date: 2014-10-30 07:30:21
---
The scenario in this blog article is that you've created a DSC configuration on a computer that's running a preview of PowerShell version 5. The machine itself could be running Windows 8.1, Server 2012 R2, or the Windows Technical Preview version of Windows 10.

Here's a simple configuration that I'll use to demonstrate the problem. This DSC configuration uses a custom DSC resource to rename a computer. This configuration is being created on a machine running the Windows Technical Preview version of Windows 10 with PowerShell version 5 build 9860 (the most recent build as of this writing).
<pre class="lang:ps decode:true">configuration ConfigureNewServer {

    Import-DscResource -ModuleName cMrComputerName

    node 192.168.29.107 {

        cMrComputerName Name {
            ComputerName = 'Server01'
        }
    }
}</pre>
A new Windows 2012 R2 Server (running PowerShell v4) has been brought online and no configuration has been done to it so far. The IP address of that server is 192.168.29.107. That IP address has been added to the TrustedHosts on the Windows 10 workstation that is being used to create the DSC configuration.

The configuration is run and the MOF file is generated for the server as shown in the following example:
<pre class="lang:ps decode:true">ConfigureNewServer</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error1.jpg"><img class="alignnone size-full wp-image-10760" src="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error1.jpg" alt="dsc-error1" width="859" height="179" /></a>

An attempt to apply the configuration to the server is made, but an error is generated:
<pre class="lang:ps decode:true">Start-DscConfiguration -Path .\ConfigureNewServer -Wait -Verbose -Credential (Get-Credential)</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error2.jpg"><img class="alignnone size-full wp-image-10761" src="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error2.jpg" alt="dsc-error2" width="859" height="335" /></a>

<em><span style="color: #ff0000;">Undefined property ConfigurationName</span></em>
<em><span style="color: #ff0000;"> At line:16, char:2</span></em>
<em><span style="color: #ff0000;"> Buffer:</span></em>
<em><span style="color: #ff0000;">onfigureNewServer";</span></em>
<em><span style="color: #ff0000;">};^</span></em>
<em><span style="color: #ff0000;">insta</span></em>
<em><span style="color: #ff0000;"> + CategoryInfo : SyntaxError: (root/Microsoft/...gurationManager:String) [], CimException</span></em>
<em><span style="color: #ff0000;"> + FullyQualifiedErrorId : MiClientApiError_Failed</span></em>
<em><span style="color: #ff0000;"> + PSComputerName : 192.168.29.107</span></em>

Since I'm using a custom DSC resource that I wrote, you might think that the error has to do with it, but this error would occur even if one of the Microsoft supplied DSC resources was being used.

The issue is that there's a couple of extra lines in the MOF files generated by a machine running PowerShell version 5 which seems to make the MOF files incompatible with a machine running PowerShell version 4.

The following MOF configuration file was created on a machine running PowerShell v5:

<a href="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error3.jpg"><img class="alignnone size-full wp-image-10762" src="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error3.jpg" alt="dsc-error3" width="487" height="520" /></a>

Here's the same MOF file created on a machine running PowerShell version 4:

<a href="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error4.jpg"><img class="alignnone size-full wp-image-10763" src="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error4.jpg" alt="dsc-error4" width="498" height="552" /></a>

Removing those two lines allows the configuration to complete successfully without issue. For a single MOF file manually modifying it probably wouldn't be an issue, but what if you had dozens or more? Then there's the question as to why you would want to do anything manually that you could use PowerShell to automate? After all, that is the purpose isn't it?

Here's a function to remove those two lines from one or more MOF files:
<pre class="lang:ps decode:true" title="ConvertTo-MrMOFv4">#Requires -Version 4.0
function ConvertTo-MrMOFv4 {

    [CmdletBinding()]
    param (
        [Parameter(Mandatory,
                   ValueFromPipelineByPropertyName)]
        [ValidateScript({Test-Path $_ -PathType Leaf -Include *.mof})]
        [Alias('FullName')]
        [string[]]$Path,

        [Parameter(DontShow)]
        [ValidateNotNullorEmpty()]
        [string]$Pattern = '^\sName=.*;$|^\sConfigurationName\s=.*;$'
    )

    PROCESS {
        foreach ($file in $Path) {
            
            $mof = Get-Content -Path $file
            
            if ($mof -match $Pattern) {
                Write-Verbose -Message "PowerShell v4 compatibility problems were found in file: $file"

                try {
                    $mof -replace $Pattern |
                    Set-Content -Path $file -Force -ErrorAction Stop
                }
                catch {
                    Write-Warning -Message "An error has occurred. Error details: $_.Exception.Message"
                }
                finally {
                    if ((Get-Content -Path $file) -notmatch $Pattern) {
                        Write-Verbose -Message "The file: $file was successfully modified."
                    }
                    else {
                        Write-Verbose -Message "Attempt to modify the file: $file was unsuccessful."
                    }
                }
            }
        }
    }
}</pre>
The path to the files can be provided via parameter or pipeline input:
<pre class="lang:ps decode:true ">Get-ChildItem -Path C:\tmp\ConfigureNewServer | ConvertTo-MrMOFv4 -Verbose</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error5a.jpg"><img class="alignnone size-full wp-image-10779" src="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error5a.jpg" alt="dsc-error5a" width="859" height="83" /></a>

Now that those two lines have been removed from the MOF file, let's try to apply the configuration again:
<pre class="lang:ps decode:true ">Start-DscConfiguration -Path .\ConfigureNewServer -Wait -Verbose -Credential (Get-Credential)</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error6.jpg"><img class="alignnone size-full wp-image-10766" src="http://mikefrobbins.com/wp-content/uploads/2014/10/dsc-error6.jpg" alt="dsc-error6" width="859" height="347" /></a>

Success!

µ