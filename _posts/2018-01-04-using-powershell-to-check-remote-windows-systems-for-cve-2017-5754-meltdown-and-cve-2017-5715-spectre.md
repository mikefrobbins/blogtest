---
ID: 16066
post_title: >
  Using PowerShell to Check Remote Windows
  Systems for CVE-2017-5754 (Meltdown) and
  CVE-2017-5715 (Spectre)
author: Mike F Robbins
post_excerpt: ""
layout: post
permalink: >
  https://mikefrobbins.com/2018/01/04/using-powershell-to-check-remote-windows-systems-for-cve-2017-5754-meltdown-and-cve-2017-5715-spectre/
published: true
post_date: 2018-01-04 12:36:35
---
The Microsoft Security Response Center has released a PowerShell module named <a href="https://www.powershellgallery.com/packages/SpeculationControl/1.0.1" target="_blank" rel="noopener"><em>SpeculationControl</em></a> that can be used to check for the CVE-2017-5754 (Meltdown) and CVE-2017-5715 (Spectre) vulnerabilities.

The <em>SpeculationControl</em> module can be installed from the PowerShell Gallery with <em>Install-Module</em> which is part of <a href="https://docs.microsoft.com/en-us/powershell/gallery/psget/get_psget_module" target="_blank" rel="noopener">the <em>PowerShellGet</em> module</a> that ships natively with PowerShell version 5.0, but can be installed on PowerShell version 3.0 and higher.
<pre class="lang:ps decode:true">Install-Module -Name SpeculationControl -Force</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control1a.jpg"><img class="alignnone size-full wp-image-16069" src="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control1a.jpg" alt="" width="859" height="127" /></a>

Running the one function (<em>Get-SpeculationControlSettings</em>) contained in the <em>SpeculationControl</em> module is simple enough, although it does require the script <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-5.1" target="_blank" rel="noopener">execution policy</a> to be set to remote signed or less restrictive.
<pre class="lang:ps decode:true">Get-SpeculationControlSettings</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control2a.jpg"><img class="alignnone size-full wp-image-16070" src="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control2a.jpg" alt="" width="859" height="368" /></a>

One problem is the function doesn't have any parameters for running it remotely. In fact, it doesn't have any parameters whatsoever.
<pre class="lang:ps decode:true">Get-Command -Name Get-SpeculationControlSettings -Syntax</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control3a.jpg"><img class="alignnone size-full wp-image-16071" src="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control3a.jpg" alt="" width="859" height="95" /></a>

While you could deploy this module to all of your remote systems, that would be a less than desirable solution.

There's a technique I blogged about back in 2014 where you can <em>"<a href="http://mikefrobbins.com/2014/03/27/run-a-local-powershell-function-against-a-remote-computer-with-powershell-remoting/" target="_blank" rel="noopener">Run a local PowerShell Function against a Remote Computer with PowerShell Remoting</a>"</em> that can be used to run this function which only exists on your local computer against remote systems without requiring the function itself to exist on the remote system.

This does however require PowerShell remoting to be enabled on the remote system.
<pre class="lang:ps decode:true">Invoke-Command -ComputerName srv1 ${function:Get-SpeculationControlSettings}</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control4b.jpg"><img class="alignnone size-full wp-image-16090" src="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control4b.jpg" alt="" width="859" height="380" /></a>

When the function is used as shown in the previous example, it doesn't trigger the module auto-loading functionality that was introduced in PowerShell version 3.0, so if you haven't already run the command against the local computer, you'll receive the following error message.

<a href="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control5a.jpg"><img class="alignnone size-full wp-image-16074" src="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control5a.jpg" alt="" width="859" height="152" /></a>

To resolve this problem, simply import the <em>SpeculationControl</em> module manually.
<pre class="lang:ps decode:true">Import-Module -Name SpeculationControl</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control6a.jpg"><img class="alignnone size-full wp-image-16075" src="http://mikefrobbins.com/wp-content/uploads/2018/01/spec-control6a.jpg" alt="" width="859" height="59" /></a>

You could also rework their command since it's a function (not complied) or write a proxy function to add remoting functionality without having to resort to this technique.

One thing to note is the <em>Get-SpeculationControlSettings</em> function uses the <em>Get-WMIObject</em> cmdlet so it's not compatible with PowerShell Core.

µ