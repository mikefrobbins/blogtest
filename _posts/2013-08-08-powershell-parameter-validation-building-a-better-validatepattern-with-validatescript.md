---
ID: 7791
post_title: 'PowerShell Parameter Validation: Building a Better ValidatePattern with ValidateScript'
author: Mike F Robbins
post_excerpt: ""
layout: post
permalink: >
  https://mikefrobbins.com/2013/08/08/powershell-parameter-validation-building-a-better-validatepattern-with-validatescript/
published: true
post_date: 2013-08-08 07:30:47
---
Let's start out by taking a look at what the PowerShell built-in help says about the <em>ValidatePattern</em> and <em>ValidateScript</em> validation attributes:

<a href="http://technet.microsoft.com/en-us/library/hh847743.aspx" target="_blank"><img class="alignnone wp-image-7801 size-full" src="http://mikefrobbins.com/wp-content/uploads/2013/08/about-fap2.png" alt="about-fap2" width="648" height="60" /></a>

Here's what that help topic says about <em>ValidatePattern</em>:

<a href="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-pattern.png"><img class="alignnone wp-image-7793 size-full" src="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-pattern.png" alt="validate-pattern" width="648" height="292" /></a>

We'll test using <em>ValidatePattern</em> with an example that I used in my entry for advanced event #4 in the Script Games this year as shown in the following example:
<pre class="lang:ps decode:true">function Test-ValidatePattern {

  [CmdletBinding()]
  param(
    [Parameter(Mandatory)]
    [ValidatePattern("^(?!^(PRN|AUX|CLOCK\$|NUL|CON|COM\d|LPT\d|\..*)(\..+)?$)[^\x00-\x1f\\?*:\"";|/]+\.html?$")]
    [string]$FileName
  )

  Write-Output $FileName

}</pre>
Who knows what that regular expression does? The guy who wrote this might, but probably no one else, especially not the junior level administrators or help desk staff who will be using this tool once it's finished.

One of the feedback comments I received on that particular scripting games entry was "<em>I wish I knew what this regular expression did ?</em>". The problem with the error messages that are generated by <em>ValidatePattern</em> is they tell you that your input didn't match the regular expression. How many tool users do you know who read regular expressions? Not many unless the tool user is also the toolmaker. They prefer error messages in their native language (English in the case of my tool users).

Based on the error message in the screenshot below, my junior level administrators and help desk staff will have no idea what they did wrong, nor will they know what to do to correct the problem if they receive this error:

<a href="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-pattern-error.png"><img class="alignnone wp-image-7796 size-full" src="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-pattern-error.png" alt="validate-pattern-error" width="757" height="233" /></a>

<em><span style="color: #ff0000;">The argument </span><span style="color: #ff0000;">"con.html" does not match the "^(?!^(PRN|AUX|CLOCK$|NUL|CON|COMd|LPTd|..*)(..+)?$)[^</span></em>
<em> <span style="color: #ff0000;">x00-x1f\?*:";|/]+.html?$" pattern. Supply an argument that matches "^(?!^(PRN|AUX|CL</span><span style="color: #ff0000;">OCK$|NUL|CON|COMd|LPTd|..*)(..+)?$)[^x00-x1f\?*:";|/]+.html?$" and try the </span><span style="color: #ff0000;">command again.</span></em>

<em>ValidateScript</em> to the rescue! <span style="line-height: 1.5;">Here's what the help says about <em>ValidateScript</em>:</span>

<a href="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-script.png"><img class="alignnone wp-image-7794 size-full" src="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-script.png" alt="validate-script" width="648" height="354" /></a>

This might be a little more work, but trust me, it will save you a lot of support calls and emails down the road when someone else tries to use this tool and receives the parameter validation error message.
<pre class="lang:ps decode:true">function Test-ValidateScript {

  [CmdletBinding()]
  param (
    [Parameter(Mandatory)]
    [ValidateScript({
      If ($_ -match "^(?!^(PRN|AUX|CLOCK\$|NUL|CON|COM\d|LPT\d|\..*)(\..+)?$)[^\x00-\x1f\\?*:\"";|/]+\.html?$") {
        $True
      }
      else {
        Throw "$_ is either not a valid filename for an HTML file or it is not recommended. See this MSDN article for more information: http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx#naming_conventions"
      }
    })]
    [string]$FileName
  )

  Write-Output $FileName

}</pre>
<a href="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-script-error.png"><img class="alignnone wp-image-7797 size-full" src="http://mikefrobbins.com/wp-content/uploads/2013/08/validate-script-error.png" alt="validate-script-error" width="757" height="216" /></a>

<span style="color: #ff0000;"><em>con.html is either not a valid filename for an HTML file or it is not recommended. See this MSDN article for more information:</em> <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx#naming_conventions" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx#naming_conventions</a></span>

<span style="line-height: 1.5;">While this may not be the best error message in the world, any error message is better than the one previously returned by the <em>ValidatePattern</em> validation attribute.</span>

Where did I learn this? I learned about "<em>A better [ValidatePattern()] with [ValidateScript()]</em>" while competing in the advanced category of the Scripting Games this year on the blog of Scripting Games Judge and Honorary Scripting Guy Boe Prox. You can find his blog on that subject here: <a href="http://learn-powershell.net/2013/05/23/scripting-games-2013-event-4-notes/" target="_blank">Scripting Games 2013: Event 4 Notes</a>.

µ